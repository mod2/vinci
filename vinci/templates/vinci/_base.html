{% load staticfiles %}
<!DOCTYPE html>
<html>
<head>
	{% block head %}
	<title>{% block title %}{{ title }}{% endblock title %}{{ SITE_TITLE_SEP }}{{ SITE_TITLE }}</title>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />

	<link href="{% static 'css/style.css' %}?v13" rel="stylesheet" type="text/css" charset="utf-8" />

	<link href="{% static 'css/lib/prism.css' %}" rel="stylesheet" type="text/css" charset="utf-8" />
	<link href="{% static 'css/lib/jquery.tagit.css' %}" rel="stylesheet" type="text/css" charset="utf-8" />
	<link href="{% static 'css/lib/tagit.ui-zendesk.css' %}" rel="stylesheet" type="text/css" charset="utf-8" />

	<script src="{% static 'js/lib/jquery-2.1.4.min.js' %}" type="text/javascript" charset="utf-8"></script>
	<script src="{% static 'js/lib/jquery-ui.min.js' %}" type="text/javascript" charset="utf-8"></script>
	<script src="{% static 'js/lib/autosize.min.js' %}" type="text/javascript" charset="utf-8"></script>
	<script src="{% static 'js/lib/mousetrap.min.js' %}" type="text/javascript" charset="utf-8"></script>
	<script src="{% static 'js/lib/mousetrap-global-bind.min.js' %}" type="text/javascript" charset="utf-8"></script>
	<script src="{% static 'js/lib/prism.js' %}" type="text/javascript" charset="utf-8"></script>

	<script src="{% static 'js/vinci.js' %}?v12" type="text/javascript" charset="utf-8"></script>

	<script type="text/javascript" charset="utf-8">
		var config = {};
		config.url = "{% url 'notebooks_list' %}";
{% if notebook %}		config.notebook = "{{ notebook.slug }}";{% endif %}
        config.api_key = "{{ API_KEY }}";
	</script>

	{% if section %}
	<link rel="shortcut icon" href="{% static 'favicon/' %}favicon-{{ section }}.png">
	{% else %}
	<link rel="shortcut icon" href="{% static 'favicon.png' %}">
	{% endif %}

	<link rel="apple-touch-icon" href="{% static 'apple-touch-icon.png' %}">
	<link rel="apple-touch-icon-precomposed" href="{% static 'apple-touch-icon.png' %}">

	{% endblock head %}
</head>

<body {% if mode %}class="{{ mode }}-mode"{% endif %}>
	<div class="wrapper">
		{% block menu %}
		<nav role="menu">
			{% if notebook %}
			<div class="group">
				<h2>Sections</h2>
				{% for s in sections %}
				<a href="{% url 'notebook_section' notebook.slug s.slug %}">{{ s.name }}</a>
				{% endfor %}
			</div>

			<div class="group">
				<h2>Modes</h2>
				{% for m in modes %}
					{% if section %}
						<a href="{% url 'notebook_section' notebook.slug section.slug %}?mode={{ m }}">{{ m }}</a>
					{% else %}
						<a href="{% url 'notebook' notebook.slug %}?mode={{ m }}">{{ m }}</a>
					{% endif %}
				{% endfor %}
			</div>

			<div class="group">
				<a href="{% url 'notebook_settings' notebook.slug %}">Notebook Settings</a>
			</div>
			{% endif %}

			<div class="group system">
				<a href="{% url 'notebooks_list' %}">Home</a></li>
				<span class="add-notebook">Add Notebook</span>
				<a href="{% url 'preferences' %}">Preferences</a>
				<a href="{% url 'logout' %}">Logout</a>
			</div>
		</nav>
		{% endblock menu %}

		<section id="page">
			<div class="mask"></div>

			{% block header %}
			<header role="banner">
				<div class="container">
					<a class="menu">&hellip;</a>
					<h1>
						{% block header_title %}
							{% if notebook %}
								<a class="home" href="{{ notebook.get_absolute_url }}">{{ notebook.name }}</a>
							{% else %}
								<span>{{ title }}</span>
							{% endif %}
						{% endblock header_title %}
					</h1>
					<div class="group">
						<span class="add-entry">+</span>
						<span class="show-search">S</span>
						<span class="show-quickjump">QJ</span>
					</div>
				</div>
			</header>
			{% endblock header %}

			{% block sections %}
			<div id="sections" class="{% if section %}{{ section }}{% else %}nosection{% endif %}">
				<div class="container"></div>
			</div>
			{% endblock sections %}

			{% block add_notebook %}
			<form id="add-notebook" data-post-uri="{% url 'api_notebook_list' %}" data-author-id="{{ request.user.id }}">
				<div class="container">
					<div class="group">
						<label>Name:</label>
						<input type="text" class="name" name="notebook_name" />
					</div>

					<input type="submit" value="Add Notebook" class="button" />
				</div>
			</form>
			{% endblock add_notebook %}

			{% block add_entry %}
			<form id="add-entry" class="edit-mode" data-uri="{% url 'api_notebook_list' %}" {% if notebook %}data-notebook-slug="{{ notebook.slug }}"{% endif %}{% if section %} data-section-slug="{{ section.slug }}"{% endif %}>
				<input class="title container" name="title" type="text" value="" placeholder="Title" />
				<textarea name="entry-content" class="container"></textarea>

				<div class="edit-panel">
					<div class="group more container">
						<a class="add" href="">Add entry</a>
					</div>
				</div>
			</form>
			{% endblock add_entry %}

			{% block search %}
			<form id="search" data-search-all-uri="{% url 'search_all' %}"{% if notebook and section %} data-search-section-uri="{% url 'search_notebook_section' notebook.slug section.slug %}"{% endif %}{% if notebook %}data-search-notebook-uri="{% url 'search_notebook' notebook.slug %}"{% endif %} data-quickjump-uri="{% url 'quick_jump' %}" class="{{ page_type }}">
				<div class="container">
					<input type="text" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false">
					<section class="scope">
						{% if section and notebook %}<span data-value="section"{% if scope == 'section' %} class="selected"{% endif %}>This Section</span>{% endif %}
						{% if notebook %}<span data-value="notebook"{% if scope == 'notebook' %} class="selected"{% endif %}>This Notebook</span>{% endif %}
						<span data-value="all"{% if scope == 'all' %} class="selected"{% endif %}>All Notebooks</span>
					</section>
					<section class="results"></section>
				</div>
			</form>
			{% endblock search %}

			{% if query %}
			<section id="results">
				<div class="container">
					<h2>{{ total }} {% if section %}{{ section }} {% endif %}result{% if total != 1 %}s{% endif %} for <span>{{ query }}</span></h2>
				</div>
			</section>
			{% endif %}

			<section id="error">
				<div class="container"></div>
			</section>

			<main id="content" class="{{ page_type }}{% if section %} {{ section }}{% endif %}"{% if notebook %} data-notebook-settings-url="{% url 'notebook_settings' notebook.slug %}"{% endif %}>
				{% block content %}{% endblock content %}
				{% block nav %}{% endblock nav %}

				{% block footer %}
				{% endblock footer %}
			</main>
		</section>
	</div>

	<div id="mask" class="{% block mask-class %}{% endblock mask-class %}"></div>
	<section id="modal" class="{% block modal-class %}{% endblock modal-class %}">
		<div id="modal-help" class="modal">
			<h2>Help</h2>

			<div class="columns">
				<div class="column">
					<div class="group">
						<label>/</label>
						<span>Search</span>
					</div>

					<div class="group">
						<label>g m</label>
						<span>Toggle menu</span>
					</div>

					<div class="group">
						<label>a</label>
						<span>Add entry</span>
					</div>

					<div class="group">
						<label>j</label>
						<span>Move down in entry list</span>
					</div>

					<div class="group">
						<label>k</label>
						<span>Move up in entry list</span>
					</div>

					<div class="group">
						<label>e</label>
						<span>Edit entry</span>
					</div>

					<div class="group">
						<label>C-&#x23ce;</label>
						<span>Save entry</span>
					</div>
				</div>

				<div class="column">
					<div class="group">
						<label>g /</label>
						<span>Quickjump</span>
					</div>

					<div class="group">
						<label>g l</label>
						<span>Logs</span>
					</div>

					<div class="group">
						<label>g n</label>
						<span>Notes</span>
					</div>

					<div class="group">
						<label>g p</label>
						<span>Pages</span>
					</div>

					<div class="group">
						<label>g j</label>
						<span>Journals</span>
					</div>

					<div class="group">
						<label>g h</label>
						<span>Home (All Notebooks)</span>
					</div>

					<div class="group">
						<label>A</label>
						<span>Add notebook</span>
					</div>
				</div>
			</div>
		</div>
		{% block modal %}
		{% endblock modal %}
	</section>
</body>
</html>
