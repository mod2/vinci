<article class="entry {{ entry.entry_type }}" data-id="{{ entry.id }}" data-uri="{{ entry.get_absolute_url }}">
	{% if not total %}
		<a class="controls-toggle" href="">&nbsp;</a>

		<div class="controls container">
			<div class="group">
				<a href="" class="delete">Delete</a>
				<a href="" class="edit">Edit</a>
			</div>
			<!--
			<div class="group move">
				<a href="" class="move">Move to </a>
				<a href="" class="copy">Copy to </a>
				<select>
					{% for n in notebooks %}<option value="{{ n.slug }}">{{ n.name }}</option>{% endfor %}
				</select>
			</div>
			-->
		</div>
	{% endif %}

	<div class="metadata container">
		{% if page_type == 'list' %}{#and entry.type == 'log' %} #}
			<a class="date" href="{{ entry.get_absolute_url }}">
				<date>{{ entry.date|date:'j M Y' }}</date>
				<time>{{ entry.date|date:'g:i A'|lower }}, {{ entry.date|date:'D' }}</time>
			</a>
			{% if entry.tags.all|length > 0 %}
			<ul class="tags">{% for tag in entry.tags.all %}<li><a href="url_for('index') ~ entry.notebook.slug ~ '/tag/' ~ tag">#{{ tag }}</a></li>{% endfor %}</ul>
			{% endif %}
		{% else %}
			<a class="date" href="{{ entry.get_absolute_url }}">
				<date>{{ entry.date|date:'j M Y' }}</date>
				<time>{{ entry.date|date:'g:i A'|lower }}, {{ entry.date|date:'D' }}</time>
			</a>
		{% endif %}
	</div>

	{% if page_type == 'list' %}
		{# Entry list #}
		{% if entry.highlight %}
			<div class="content excerpt container">&hellip; {{ entry.highlight|safe }} &hellip;</div>
		{% else %}
			<div class="content container">
				{% if entry.title %}
				<h3><a href="{{ entry.get_absolute_url }}">{% if entry.title != '' %}{{ entry.title }}{% elif entry.slug != '' %}{{ entry.slug }}{% else %}no title!{% endif %}</a></h3>
				{% else %}
				{{ entry.html|safe }}
				{% endif %}
			</div>
		{% endif %}
    {% else %}
		{# Detail page #}
		<div class="content container">
			{{ entry.html|safe }}
		</div>
	{% endif %}

	<form class="edit-mode">
		<input class="title container" name="title" type="text" value="{{ entry.title }}" placeholder="Title" />
		<textarea name="content" class="container">{{ entry.current_revision.content }}</textarea>

		<div class="edit-panel">
			<div class="group tags other container">
				<label>Tags:</label><input name="tags" type="text" value="{{ entry.tags.all|join:',' }}" />
			</div>
			<div class="group other container">
				<label>Date:</label><input name="date" type="text" value="{{ entry.date|date:'Y-m-d H:i:s' }}" />
			</div>
			<div class="group other container">
				<label>Type:</label>
				{% for t in entry.get_possible_types %}<span data-value="{{ t.value }}" class="type {{ t.value }}{% if entry.entry_type == t.value %} selected{% endif %}">{{ t.label }}</span>{% endfor %}
				<input type="hidden" name="type" value="{{ entry.entry_type }}" />
			</div>
			<div class="group other notebook container">
				<label>Notebook:</label>
				<select name="type">
					{% for n in notebooks %}<option value="{{ n.slug }}"{% if entry.notebook.slug == n.slug %} selected{% endif %}>{{ n.name }}</option>{% endfor %}
				</select>
			</div>
			<div class="group other container">
				<div class="buttons">
					<span class="button delete">Delete Entry</span>
				</div>
			</div>
			<div class="group more container">
				<a href="">Toggle advanced</a>
			</div>
		<!-- TODO: delete when autosave is done
			<input type="submit" value="Save {% if entry.slug == '' %}Entry{% else %}Page{% endif %}" class="button" />
		-->
		</div>
	</form>
</article>
